create or replace table cappscore as select
A.ST_CD	,
A.POL_ID_CHAR,
A.SUFFIX,
A.POLEXPYR,
A.COH_INCP_DT, 
A.channel,
A.PTSPD_D,
A.PRLIM3_COH,
A.PCT_COH ,
A.PCARR_COH ,
A.MULTI_DR_COH ,
A.LAPSE2_COH ,
A.MC_COH ,
A.POP_COH ,
A.A51CREDIT_MXMTCH_NRW_COH,
A.RISK_5YR,
A.DRVRCNT,
MIN(A.vage) AS MINVAGE,
MAX(A.AGE) AS MAXDRVAGE,
MIN(A.AGE) AS MINDRVAGE,
sum(B.ECYPD) AS SUM_ECYPD,
sum(B.ILTOT_ALL) AS SUM_ILTOT,
sum(B.ILCAP_ALL) AS SUM_ILCAP,
sum(B.EXP_LOSS_ALL) AS SUM_EXP_LOSS,
sum(B.EP_ALL) AS SUM_EPALL

from PLRND.RAW.CAPP21_RAW_DATA_V19_NODUP as A
right join plrnd.staging_scored.scored_di_89_capp21_v7 as B
on A.ST_CD=B.ST_CD
AND A.POL_ID_CHAR =B.POL_ID_CHAR
AND A.SUFFIX=B.SUFFIX
AND A.POLEXPYR=B.POLEXPYR
AND A.VEHPOS=B.VEHPOS
AND A.VEHVRSN=B.VEHVRSN
WHERE A.COH_INCP_DT>='2018-01-01'
AND A.COH_INCP_DT<='2023-01-01'
GROUP BY 
A.ST_CD	,
A.POL_ID_CHAR	,
A.SUFFIX,
A.POLEXPYR,
A.COH_INCP_DT, 
A.channel,
A.PTSPD_D,
A.PRLIM3_COH,
A.PCT_COH ,
A.PCARR_COH ,
A.MULTI_DR_COH ,
A.LAPSE2_COH ,
A.MC_COH ,
A.POP_COH ,
A.A51CREDIT_MXMTCH_NRW_COH,
A.RISK_5YR,
A.DRVRCNT
;
